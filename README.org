#+title: Dictionary-overlay

* 目标
辅助英文较弱的 Emacser 进行英文阅读。提供了两种能力：
1. 生词本提示：自定义“生词本”，阅读英文文章时，通过 overlay 给生词添加中文翻译。
2. 透析阅读法：自定义“熟词本”，阅读英文文章时，通过 overlay 翻译当前文章所有未标记为“熟词”的单词

   #+caption: Example
  [[file:images/2022-11-15_21-23-58_screenshot.png]]

* 安装
** [[https://github.com/ginqi7/websocket-bridge][websocket-bridge]]
用于 Emacs 与外部应用进行 websocket 通信
** Python 相关包
插件通过 python 编写，需要安装 python3
- [[https://github.com/ginqi7/websocket-bridge-python][websocket-bridge-python]] websocket-bridge 的 python 客户端
- [[https://github.com/huggingface/tokenizers][tokenizers]] python 分词工具
- six pystardict.py 的依赖
2. [[https://git.ookami.one/cgit/google-translate/][google-translate]] 用于网络翻译，非必选，可以用 crow-translate 替换

你可以使用 ~dictionary-overlay-install~ 来安装相关的 python 包（不包括 google-translate）。

** 网络翻译
默认会使用 sdcv 本地词典翻译。当单词在本地词典未找到时，会使用网络翻译，目前支持：
1. [[https://crow-translate.github.io/][crow-translate]]
2. [[https://git.ookami.one/cgit/google-translate/][google-translate]]

你可以使用： ~dictionary-overlay-install-google-translate~ 来安装 google-translate

** 下载 dictionary-overlay
#+begin_src shell
git clone --depth=1 -b main https://github.com/ginqi7/dictionary-overlay ~/.emacs.d/site-lisp/dictionary-overlay/
#+end_src

** 添加下面配置到 ~/.emacs
#+begin_src emacs-lisp
  (add-to-list 'load-path "~/.emacs.d/site-lisp/dictionary-overlay/")
  (require 'dictionary-overlay)
#+end_src

* 命令
| 命令                                        | 说明                                                |
|---------------------------------------------+-----------------------------------------------------|
| dictionary-overlay-start                    | 启动 dictionary-overlay 应用                        |
| dictionary-overlay-restart                  | 重启 dictionary-overlay 应用                        |
| dictionary-overlay-render-buffer            | 使用翻译渲染当前 buffer                              |
| dictionary-overlay-toggle            | 打开\关闭翻译渲染当前 buffer                         |
| dictionary-overlay-jump-next-unknown-word   | 跳转到下一个生词                                    |
| dictionary-overlay-jump-prev-unknown-word   | 跳转到上一个生词                                    |
| dictionary-overlay-mark-word-known          | 标记当前单词为“已知”                                |
| dictionary-overlay-mark-word-unknown        | 标记当前单词为“生词”                                |
| dictionary-overlay-mark-buffer              | 标签当前 buffer 中所有未标记为“生词”的单词全为“已知” |
| dictionary-overlay-mark-buffer-unknown      | 标签当前 buffer 中所有未标记为“生词”的单词全为“未知”   |
| dictionary-overlay-install                  | 安装 dictionary-overlay 所依赖的必选 python 包          |
| dictionary-overlay-install-google-translate | 安装 google-translate                                       |

* 选项

| 选项                                   | 说明                                                               |
| dictionary-overlay-just-unknown-words  | t 时使用“生词本”模式，nil 为“透析阅读”模式，默认为 t                |
| dictionary-overlay-user-data-directory | 用户数据存放的目录，默认值为：“~/.emacs.d/dictionary-overlay-data” |

* 使用方法探讨

默认使用“生词本”模式，阅读英文文章时，需要手动添加生词（ ~dictionary-overlay-mark-word-unknown~ ）。可以和你的“查询单词”的快捷键保持在一起。那么你下次遇到生词时，会自动展示出生词。

当你开始阅读文章时，可以把当前 buffer 中所有未标记为 known 的单词标记为 unknown ( ~dictionary-overlay-mark-buffer-unknown~ )

当你阅读完一篇文章以后，可以把当前 buffer 中所有未标记为 unknown 的单词标记为 known ( ~dictionary-overlay-mark-buffer~ )

当一个生词反复出现，你觉得自己已经认识了它，可以标记为 known （ ~dictionary-overlay-mark-word-known~ ），下次不再展示翻译。

当你阅读了足够多的文章，你应该积累了一定量的 know-words ，此时，或许你可以尝试使用"透析阅读法"（ ~(setq dictionary-overlay-just-unknown-words nil)~ ）将自动展示，“或许”你不认识的单词。

* TODO
- [ ] 尝试使用 nltk 进行词形还原
- [ ] 增加翻译修改功能，允许用户选择合适的词意
